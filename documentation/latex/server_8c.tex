\hypertarget{server_8c}{}\doxysection{server/server.c File Reference}
\label{server_8c}\index{server/server.c@{server/server.c}}
{\ttfamily \#include $<$arpa/inet.\+h$>$}\newline
{\ttfamily \#include $<$ctype.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$sys/socket.\+h$>$}\newline
{\ttfamily \#include $<$time.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include \char`\"{}../shared/shared.\+h\char`\"{}}\newline
Include dependency graph for server.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{server_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{server_8c_a42bf63540ee0039a3a23db1b5ec3202b}{CONFIG\+\_\+\+FILE}}~\char`\"{}config.\+cfg\char`\"{}
\item 
\#define \mbox{\hyperlink{server_8c_a053b7859476cc9867ec62c49e68d3fa1}{MAX\+\_\+\+CONNECTIONS}}~10
\item 
\#define \mbox{\hyperlink{server_8c_a5bb74f89a7ccccb5b72cb10e21b6a2f9}{MAX\+\_\+\+FIELD\+\_\+\+SIZE}}~20
\item 
\#define \mbox{\hyperlink{server_8c_a1d87411411dd1e46bb054e543df3c8c8}{BUF\+\_\+\+CONFIG\+\_\+\+SIZE}}~50
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{server_8c_ad6261f040bd258f001d04dc874097482}{init\+\_\+configuration}} (FILE $\ast$file)
\begin{DoxyCompactList}\small\item\em Инициализирует конфигурацию сервера. Считывает значения из файла конфигурации. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{server_8c_a194df5ce354a85b622ec15eeb1e432a5}{handle\+\_\+client}} (int client\+\_\+socket, int server\+\_\+socket)
\begin{DoxyCompactList}\small\item\em Обрабатывает подключение клиента. Создает дочерний процесс, который обрабатывает ходы игрока и отправляет ответы. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{server_8c_a9c4c815a40b6ad2d889606f8e7fa66eb}{place\+\_\+ships}} (char $\ast$$\ast$$\ast$\mbox{\hyperlink{client_8c_a52aa3794e6bc5c84d923de87a2d4e435}{playing\+\_\+field}}, int number\+\_\+of\+\_\+ships)
\begin{DoxyCompactList}\small\item\em Расставляет корабли на игровом поле. Количество кораблей задается в аргументе. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{server_8c_ae246e04c3eb6b6dc6d41f9485da9a0c7}{logging}} (char $\ast$message)
\begin{DoxyCompactList}\small\item\em Ведет логирование подключения клиента. Записывает в лог время подключения и имя клиента. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{server_8c_a23212950e729b793025fd5109c6eb155}{process\+\_\+player\+\_\+move}} (char $\ast$move, char $\ast$answer, int $\ast$number\+\_\+of\+\_\+moves, int $\ast$number\+\_\+of\+\_\+ships)
\begin{DoxyCompactList}\small\item\em Обрабатывает ход игрока. Проверяет, попал ли игрок в корабль, и изменяет игровое поле \end{DoxyCompactList}\item 
\mbox{\hyperlink{shared_8h_af6a258d8f3ee5206d682d799316314b1}{bool}} \mbox{\hyperlink{server_8c_ac746ba306bd0b9ce4c390cb8cbbc5004}{is\+\_\+valid\+\_\+position}} (char $\ast$$\ast$\mbox{\hyperlink{client_8c_a52aa3794e6bc5c84d923de87a2d4e435}{playing\+\_\+field}}, int x, int y)
\begin{DoxyCompactList}\small\item\em Проверяет, является ли позиция на игровом поле допустимой. Позиция допустима, если вокруг нее нет кораблей. \end{DoxyCompactList}\item 
\mbox{\hyperlink{shared_8h_af6a258d8f3ee5206d682d799316314b1}{bool}} \mbox{\hyperlink{server_8c_a8c360e0dce3321283e4979437859c0b7}{check\+\_\+configuration}} (\mbox{\hyperlink{structServerConfig}{Server\+Config}} \mbox{\hyperlink{client_8c_a1b7330a63adb86a9fc92a875e4c722fc}{config}})
\begin{DoxyCompactList}\small\item\em Проверяет конфигурацию сервера на корректность. Проверяет размер поля и количество кораблей. Если размер поля больше максимального или количество кораблей больше, чем может поместиться на поле,. \end{DoxyCompactList}\item 
\mbox{\hyperlink{shared_8h_a881b49e3802366255ad852f1c8624fd1}{Game\+Status}} \mbox{\hyperlink{server_8c_a826a4475252fe7971212c5e29001f744}{check\+\_\+game\+\_\+status}} (int number\+\_\+of\+\_\+moves, int number\+\_\+of\+\_\+ships)
\begin{DoxyCompactList}\small\item\em Проверяет статус игры. Если количество ходов превышает максимальное, возвращает LOSE. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{server_8c_a840291bc02cba5474a4cb46a9b9566fe}{main}} (void)
\begin{DoxyCompactList}\small\item\em Главная функция сервера. Инициализирует конфигурацию, создает сокет сервера, привязывает его к адресу и порту, указанным в конфигурации, и начинает слушать входящие соединения. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{structServerConfig}{Server\+Config}} \mbox{\hyperlink{server_8c_ab0196e30c40099fcc01057bbcfda6433}{config}}
\item 
\mbox{\hyperlink{structConfigOption}{Config\+Option}} \mbox{\hyperlink{server_8c_a29155525d19b953df43385744a19dcf0}{options}} \mbox{[}$\,$\mbox{]}
\item 
char $\ast$$\ast$ \mbox{\hyperlink{server_8c_a52aa3794e6bc5c84d923de87a2d4e435}{playing\+\_\+field}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Файл сервера игры \char`\"{}Морской бой\char`\"{}. \begin{DoxyAuthor}{Author}
Гавриш А.\+А. 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
13.\+04.\+2024 
\end{DoxyDate}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{server_8c_a1d87411411dd1e46bb054e543df3c8c8}\label{server_8c_a1d87411411dd1e46bb054e543df3c8c8}} 
\index{server.c@{server.c}!BUF\_CONFIG\_SIZE@{BUF\_CONFIG\_SIZE}}
\index{BUF\_CONFIG\_SIZE@{BUF\_CONFIG\_SIZE}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{BUF\_CONFIG\_SIZE}{BUF\_CONFIG\_SIZE}}
{\footnotesize\ttfamily \#define BUF\+\_\+\+CONFIG\+\_\+\+SIZE~50}

\mbox{\Hypertarget{server_8c_a42bf63540ee0039a3a23db1b5ec3202b}\label{server_8c_a42bf63540ee0039a3a23db1b5ec3202b}} 
\index{server.c@{server.c}!CONFIG\_FILE@{CONFIG\_FILE}}
\index{CONFIG\_FILE@{CONFIG\_FILE}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{CONFIG\_FILE}{CONFIG\_FILE}}
{\footnotesize\ttfamily \#define CONFIG\+\_\+\+FILE~\char`\"{}config.\+cfg\char`\"{}}

\mbox{\Hypertarget{server_8c_a053b7859476cc9867ec62c49e68d3fa1}\label{server_8c_a053b7859476cc9867ec62c49e68d3fa1}} 
\index{server.c@{server.c}!MAX\_CONNECTIONS@{MAX\_CONNECTIONS}}
\index{MAX\_CONNECTIONS@{MAX\_CONNECTIONS}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{MAX\_CONNECTIONS}{MAX\_CONNECTIONS}}
{\footnotesize\ttfamily \#define MAX\+\_\+\+CONNECTIONS~10}

\mbox{\Hypertarget{server_8c_a5bb74f89a7ccccb5b72cb10e21b6a2f9}\label{server_8c_a5bb74f89a7ccccb5b72cb10e21b6a2f9}} 
\index{server.c@{server.c}!MAX\_FIELD\_SIZE@{MAX\_FIELD\_SIZE}}
\index{MAX\_FIELD\_SIZE@{MAX\_FIELD\_SIZE}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{MAX\_FIELD\_SIZE}{MAX\_FIELD\_SIZE}}
{\footnotesize\ttfamily \#define MAX\+\_\+\+FIELD\+\_\+\+SIZE~20}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{server_8c_a8c360e0dce3321283e4979437859c0b7}\label{server_8c_a8c360e0dce3321283e4979437859c0b7}} 
\index{server.c@{server.c}!check\_configuration@{check\_configuration}}
\index{check\_configuration@{check\_configuration}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{check\_configuration()}{check\_configuration()}}
{\footnotesize\ttfamily \mbox{\hyperlink{shared_8h_af6a258d8f3ee5206d682d799316314b1}{bool}} check\+\_\+configuration (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structServerConfig}{Server\+Config}}}]{config }\end{DoxyParamCaption})}



Проверяет конфигурацию сервера на корректность. Проверяет размер поля и количество кораблей. Если размер поля больше максимального или количество кораблей больше, чем может поместиться на поле,. 


\begin{DoxyParams}{Parameters}
{\em config} & Конфигурация сервера. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true, если конфигурация допустима, иначе false. 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_a826a4475252fe7971212c5e29001f744}\label{server_8c_a826a4475252fe7971212c5e29001f744}} 
\index{server.c@{server.c}!check\_game\_status@{check\_game\_status}}
\index{check\_game\_status@{check\_game\_status}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{check\_game\_status()}{check\_game\_status()}}
{\footnotesize\ttfamily \mbox{\hyperlink{shared_8h_a881b49e3802366255ad852f1c8624fd1}{Game\+Status}} check\+\_\+game\+\_\+status (\begin{DoxyParamCaption}\item[{int}]{number\+\_\+of\+\_\+moves,  }\item[{int}]{number\+\_\+of\+\_\+ships }\end{DoxyParamCaption})}



Проверяет статус игры. Если количество ходов превышает максимальное, возвращает LOSE. 


\begin{DoxyParams}{Parameters}
{\em number\+\_\+of\+\_\+moves} & Количество ходов. \\
\hline
{\em number\+\_\+of\+\_\+ships} & Количество кораблей. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Статус игры. 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_a194df5ce354a85b622ec15eeb1e432a5}\label{server_8c_a194df5ce354a85b622ec15eeb1e432a5}} 
\index{server.c@{server.c}!handle\_client@{handle\_client}}
\index{handle\_client@{handle\_client}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{handle\_client()}{handle\_client()}}
{\footnotesize\ttfamily void handle\+\_\+client (\begin{DoxyParamCaption}\item[{int}]{client\+\_\+socket,  }\item[{int}]{server\+\_\+socket }\end{DoxyParamCaption})}



Обрабатывает подключение клиента. Создает дочерний процесс, который обрабатывает ходы игрока и отправляет ответы. 


\begin{DoxyParams}{Parameters}
{\em client\+\_\+socket} & Сокет клиента. \\
\hline
{\em server\+\_\+socket} & Сокет сервера. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_ad6261f040bd258f001d04dc874097482}\label{server_8c_ad6261f040bd258f001d04dc874097482}} 
\index{server.c@{server.c}!init\_configuration@{init\_configuration}}
\index{init\_configuration@{init\_configuration}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{init\_configuration()}{init\_configuration()}}
{\footnotesize\ttfamily void init\+\_\+configuration (\begin{DoxyParamCaption}\item[{FILE $\ast$}]{file }\end{DoxyParamCaption})}



Инициализирует конфигурацию сервера. Считывает значения из файла конфигурации. 


\begin{DoxyParams}{Parameters}
{\em file} & Файл конфигурации. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_ac746ba306bd0b9ce4c390cb8cbbc5004}\label{server_8c_ac746ba306bd0b9ce4c390cb8cbbc5004}} 
\index{server.c@{server.c}!is\_valid\_position@{is\_valid\_position}}
\index{is\_valid\_position@{is\_valid\_position}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{is\_valid\_position()}{is\_valid\_position()}}
{\footnotesize\ttfamily \mbox{\hyperlink{shared_8h_af6a258d8f3ee5206d682d799316314b1}{bool}} is\+\_\+valid\+\_\+position (\begin{DoxyParamCaption}\item[{char $\ast$$\ast$}]{playing\+\_\+field,  }\item[{int}]{x,  }\item[{int}]{y }\end{DoxyParamCaption})}



Проверяет, является ли позиция на игровом поле допустимой. Позиция допустима, если вокруг нее нет кораблей. 


\begin{DoxyParams}{Parameters}
{\em playing\+\_\+field} & Игровое поле. \\
\hline
{\em x} & Координата X. \\
\hline
{\em y} & Координата Y. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true, если позиция допустима, иначе false. 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_ae246e04c3eb6b6dc6d41f9485da9a0c7}\label{server_8c_ae246e04c3eb6b6dc6d41f9485da9a0c7}} 
\index{server.c@{server.c}!logging@{logging}}
\index{logging@{logging}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{logging()}{logging()}}
{\footnotesize\ttfamily void logging (\begin{DoxyParamCaption}\item[{char $\ast$}]{message }\end{DoxyParamCaption})}



Ведет логирование подключения клиента. Записывает в лог время подключения и имя клиента. 


\begin{DoxyParams}{Parameters}
{\em message} & Сообщение. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{server_8c_a840291bc02cba5474a4cb46a9b9566fe}\label{server_8c_a840291bc02cba5474a4cb46a9b9566fe}} 
\index{server.c@{server.c}!main@{main}}
\index{main@{main}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Главная функция сервера. Инициализирует конфигурацию, создает сокет сервера, привязывает его к адресу и порту, указанным в конфигурации, и начинает слушать входящие соединения. 

\begin{DoxyReturn}{Returns}
EXIT\+\_\+\+SUCCESS в случае успешного завершения, иначе EXIT\+\_\+\+FAILURE. 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_a9c4c815a40b6ad2d889606f8e7fa66eb}\label{server_8c_a9c4c815a40b6ad2d889606f8e7fa66eb}} 
\index{server.c@{server.c}!place\_ships@{place\_ships}}
\index{place\_ships@{place\_ships}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{place\_ships()}{place\_ships()}}
{\footnotesize\ttfamily void place\+\_\+ships (\begin{DoxyParamCaption}\item[{char $\ast$$\ast$$\ast$}]{playing\+\_\+field,  }\item[{int}]{number\+\_\+of\+\_\+ships }\end{DoxyParamCaption})}



Расставляет корабли на игровом поле. Количество кораблей задается в аргументе. 


\begin{DoxyParams}{Parameters}
{\em playing\+\_\+field} & Указатель на игровое поле. \\
\hline
{\em number\+\_\+of\+\_\+ships} & Количество кораблей. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_a23212950e729b793025fd5109c6eb155}\label{server_8c_a23212950e729b793025fd5109c6eb155}} 
\index{server.c@{server.c}!process\_player\_move@{process\_player\_move}}
\index{process\_player\_move@{process\_player\_move}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{process\_player\_move()}{process\_player\_move()}}
{\footnotesize\ttfamily void process\+\_\+player\+\_\+move (\begin{DoxyParamCaption}\item[{char $\ast$}]{move,  }\item[{char $\ast$}]{answer,  }\item[{int $\ast$}]{number\+\_\+of\+\_\+moves,  }\item[{int $\ast$}]{number\+\_\+of\+\_\+ships }\end{DoxyParamCaption})}



Обрабатывает ход игрока. Проверяет, попал ли игрок в корабль, и изменяет игровое поле 


\begin{DoxyParams}{Parameters}
{\em move} & Ход игрока в формате \char`\"{}\+XY\char`\"{}, где X -\/ буква, Y -\/ число. \\
\hline
{\em answer} & Строка, в которую записывается ответ. \\
\hline
{\em number\+\_\+of\+\_\+moves} & Указатель на количество ходов. \\
\hline
{\em number\+\_\+of\+\_\+ships} & Указатель на количество кораблей. \\
\hline
\end{DoxyParams}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{server_8c_ab0196e30c40099fcc01057bbcfda6433}\label{server_8c_ab0196e30c40099fcc01057bbcfda6433}} 
\index{server.c@{server.c}!config@{config}}
\index{config@{config}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{config}{config}}
{\footnotesize\ttfamily \mbox{\hyperlink{structServerConfig}{Server\+Config}} config}

\mbox{\Hypertarget{server_8c_a29155525d19b953df43385744a19dcf0}\label{server_8c_a29155525d19b953df43385744a19dcf0}} 
\index{server.c@{server.c}!options@{options}}
\index{options@{options}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{options}{options}}
{\footnotesize\ttfamily \mbox{\hyperlink{structConfigOption}{Config\+Option}} options\mbox{[}$\,$\mbox{]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{= \{}
\DoxyCodeLine{    \{\textcolor{stringliteral}{"{}field\_size"{}}, \&\mbox{\hyperlink{server_8c_ab0196e30c40099fcc01057bbcfda6433}{config}}.\mbox{\hyperlink{structServerConfig_a4747ea34a3f8a86bc560b66ff2de692f}{field\_size}}, \mbox{\hyperlink{shared_8c_a85cd4a6b130849a86705f042b7a3ec43}{parse\_int}}\},}
\DoxyCodeLine{    \{\textcolor{stringliteral}{"{}number\_of\_moves"{}}, \&\mbox{\hyperlink{server_8c_ab0196e30c40099fcc01057bbcfda6433}{config}}.\mbox{\hyperlink{structServerConfig_a246165d72bcadec18d24d0f390c990cd}{number\_of\_moves}}, \mbox{\hyperlink{shared_8c_a85cd4a6b130849a86705f042b7a3ec43}{parse\_int}}\},}
\DoxyCodeLine{    \{\textcolor{stringliteral}{"{}number\_of\_ships"{}}, \&\mbox{\hyperlink{server_8c_ab0196e30c40099fcc01057bbcfda6433}{config}}.\mbox{\hyperlink{structServerConfig_a5346233125145ae52fa117479a4c140c}{number\_of\_ships}}, \mbox{\hyperlink{shared_8c_a85cd4a6b130849a86705f042b7a3ec43}{parse\_int}}\},}
\DoxyCodeLine{    \{\textcolor{stringliteral}{"{}server\_port"{}}, \&\mbox{\hyperlink{server_8c_ab0196e30c40099fcc01057bbcfda6433}{config}}.\mbox{\hyperlink{structServerConfig_a378da273a9f2ef0493e1eff97dc4f4d1}{server\_port}}, \mbox{\hyperlink{shared_8c_a85cd4a6b130849a86705f042b7a3ec43}{parse\_int}}\},}
\DoxyCodeLine{    \{\textcolor{stringliteral}{"{}server\_address"{}}, \&\mbox{\hyperlink{server_8c_ab0196e30c40099fcc01057bbcfda6433}{config}}.\mbox{\hyperlink{structServerConfig_a5213a7e19c2716f374274d928cd1c622}{server\_address}}, \mbox{\hyperlink{shared_8c_a3b2b83c71829097eec024f5fae768690}{parse\_string}}\},}
\DoxyCodeLine{\}}

\end{DoxyCode}
\mbox{\Hypertarget{server_8c_a52aa3794e6bc5c84d923de87a2d4e435}\label{server_8c_a52aa3794e6bc5c84d923de87a2d4e435}} 
\index{server.c@{server.c}!playing\_field@{playing\_field}}
\index{playing\_field@{playing\_field}!server.c@{server.c}}
\doxysubsubsection{\texorpdfstring{playing\_field}{playing\_field}}
{\footnotesize\ttfamily char$\ast$$\ast$ playing\+\_\+field}

